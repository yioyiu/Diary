# 每日记录网页

> AI增强的日记/学习记录工具

## 功能特性

- ✅ **每日记录**：支持 Markdown 格式的日记/学习内容输入
- ✅ **AI 自动总结**：保存时自动生成简短摘要，显示在日历格子中
- ✅ **月度回顾**：基于当月所有记录生成 AI 学习报告
- ✅ **主题词云**：AI 提取关键词，可视化展示学习主题
- ✅ **月度总结缓存**：智能缓存机制，提升加载速度
- ✅ **云端存储**：使用 Supabase 持久化所有数据
- ✅ **实时预览**：Markdown 编辑器支持实时预览

## 技术栈

- **Next.js 14** (App Router)
- **React 18** + **TypeScript**
- **Tailwind CSS**
- **Supabase** (数据库 + 认证)
- **ZHIPU AI** (GLM 4.5 FLASH)

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 配置环境变量

复制 `env.example` 为 `.env.local` 并填写配置：

```bash
# Windows
copy env.example .env.local

# Linux/Mac
cp env.example .env.local
```

需要配置的变量：
- `NEXT_PUBLIC_SUPABASE_URL` - Supabase 项目 URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Supabase 匿名密钥
- `SUPABASE_SERVICE_ROLE_KEY` - Supabase 服务角色密钥（可选，用于服务端操作）
- `ZHIPU_API_KEY` - ZHIPU AI API 密钥

### 3. 初始化 Supabase 数据库

在 Supabase 控制台的 SQL Editor 中执行 `supabase-schema.sql` 文件中的 SQL 脚本。

该脚本会创建：
- `daily_records` 表：存储每日记录
- `monthly_summary` 表：存储月度总结（带缓存功能）
- 必要的索引和 RLS（行级安全）策略

### 4. 启动开发服务器

```bash
npm run dev
```

打开 [http://localhost:3001](http://localhost:3001) 查看应用。

## 项目结构

```
src/
├── app/                    # Next.js App Router
│   ├── layout.tsx          # 全局布局
│   ├── page.tsx            # 首页
│   ├── record/             # 记录页面
│   │   ├── page.tsx
│   │   ├── actions.ts      # Server Actions
│   │   └── components/
│   │       ├── Calendar.tsx
│   │       └── Editor.tsx
│   └── review/             # 回顾页面
│       ├── page.tsx
│       ├── actions.ts
│       └── components/
│           ├── SummaryCard.tsx
│           ├── Charts.tsx
│           └── DailyList.tsx
├── lib/                    # 工具库
│   ├── supabase/          # Supabase 客户端
│   ├── ai/                # AI 客户端
│   ├── utils.ts           # 工具函数
│   └── date.ts            # 日期处理
└── types/                 # TypeScript 类型
    ├── record.ts
    ├── summary.ts
    └── database.ts
```

## 使用说明

### 首次使用

#### 1. 注册账户

1. 访问网站首页
2. 点击右上角的"登录"按钮
3. 在登录页面，点击"还没有账户？点击注册"
4. 输入邮箱和密码（至少6个字符）
5. 点击"注册"按钮
6. 如果启用了邮箱验证，请检查邮箱并点击验证链接
7. 注册成功后会自动跳转到记录页面

#### 2. 登录账户

1. 访问网站首页
2. 点击右上角的"登录"按钮
3. 输入注册时的邮箱和密码
4. 点击"登录"按钮
5. 登录成功后会自动跳转到记录页面

> **注意**：未登录用户点击"记录"或"回顾"时，会自动跳转到登录页面。登录成功后会返回到原本想访问的页面。

### 首页 (`/`)

首页是网站的入口，包含以下内容：

- **标题**：显示"每日记录"和"学习/想法记录工具"
- **记录卡片**：点击可进入记录页面
- **回顾卡片**：点击可进入回顾页面
- **导航栏**：
  - 左侧：网站 Logo
  - 中间：记录、回顾链接（登录后可见）
  - 右侧：登录/登出按钮

### 记录页面 (`/record`)

记录页面是核心功能页面，用于记录每日的学习和想法。

#### 页面布局

页面分为左右两部分：

- **左侧：日历视图**
  - 显示当前月份的日历
  - 有记录的日期会显示 AI 生成的摘要
  - 当前选中的日期会高亮显示
  - 顶部有月份切换按钮（← →）和"今天"按钮

- **右侧：编辑器**
  - 显示当前选中日期的记录
  - 支持 Markdown 格式输入
  - 实时预览功能
  - 底部有保存按钮

#### 详细操作步骤

1. **选择日期**
   - 方法一：点击日历中的日期
   - 方法二：使用左侧的月份切换按钮（← →）切换到其他月份，然后点击日期
   - 方法三：点击"今天"按钮快速跳转到今天

2. **输入内容**
   - 在右侧编辑器中输入你的学习和想法
   - 支持 Markdown 格式（见下方 Markdown 使用说明）
   - 可以输入多段内容，用空行分隔
   - 内容会自动保存为草稿（在浏览器本地）

3. **保存记录**
   - 点击编辑器底部的"保存"按钮
   - 保存后，AI 会自动生成摘要
   - 摘要会显示在日历对应日期的格子里
   - 如果内容为空或只有空格/符号，保存后会删除该日期的记录

4. **查看历史记录**
   - 在日历中，有记录的日期会显示 AI 生成的摘要
   - 点击日期可以查看和编辑该日期的完整内容
   - 摘要通常包含 2-5 个要点，每个要点一行

5. **编辑已有记录**
   - 选择日期后，编辑器会自动加载该日期的内容
   - 修改后点击"保存"按钮即可更新
   - 更新后 AI 会重新生成摘要

#### Markdown 使用说明

编辑器支持 Markdown 格式，常用语法如下：

```markdown
# 一级标题
## 二级标题
### 三级标题

**粗体文本**
*斜体文本*

- 无序列表项 1
- 无序列表项 2

1. 有序列表项 1
2. 有序列表项 2

> 引用文本

`代码片段`

[链接文本](https://example.com)

![图片描述](图片地址)
```

**提示**：
- 使用空行分隔段落
- 使用 `#` 创建标题
- 使用 `-` 或 `*` 创建列表
- 使用 `**` 加粗文本
- 使用 `` ` `` 包裹代码

#### AI 摘要生成

- **自动生成**：每次保存记录时，AI 会自动分析内容并生成摘要
- **摘要格式**：摘要通常包含 2-5 个要点，每个要点一行，简洁明了
- **摘要内容**：AI 会提取核心学习点、重要事件或反思
- **显示位置**：摘要显示在日历对应日期的格子里
- **失败处理**：如果 AI 生成失败，记录仍会保存，只是没有摘要

### 回顾页面 (`/review`)

回顾页面用于查看月度学习总结和成长报告。

#### 页面布局

页面包含以下部分：

- **顶部导航栏**：记录、回顾链接和登录/登出按钮
- **月份选择器**：显示当前查看的月份，可以切换月份
- **生成月度总结按钮**：点击可生成指定月份的 AI 总结
- **月度总结卡片**：显示 AI 生成的月度报告（如果有）
- **图表区域**：显示学习统计图表和关键词词云
- **每日摘要列表**：显示该月所有日期的摘要

#### 详细操作步骤

1. **选择月份**
   - 使用月份选择器左侧的 `←` 按钮切换到上一个月
   - 使用月份选择器右侧的 `→` 按钮切换到下一个月
   - 月份选择器显示格式：`YYYY年MM月回顾`

2. **生成月度总结**
   - 点击右上角的"生成月度总结"按钮
   - 在弹出的对话框中选择要生成的年份和月份
   - 点击"生成总结"按钮
   - 等待 AI 生成（可能需要几秒到几十秒）
   - 生成完成后，月度总结卡片会显示在页面上方

3. **查看月度总结**
   月度总结包含以下内容：
   - **整体概述**：200-300 字的月度学习情况总结
   - **重要收获**：5-8 条最重要的学习收获和感悟
   - **学习主题**：3-5 个主要学习主题，每个主题包含名称和描述
   - **关键词**：15-20 个关键词，按重要性排序，显示出现次数

4. **查看图表**
   - **关键词词云**：可视化展示本月出现的关键词，字体大小表示重要性
   - **学习统计**：显示本月记录数量、学习天数等统计信息

5. **查看每日摘要**
   - 页面底部显示该月所有日期的摘要列表
   - 按日期顺序排列
   - 每个日期显示 AI 生成的摘要要点
   - 如果某天没有记录，则不会显示

6. **缓存机制**
   - 月度总结会自动缓存
   - 如果该月的记录没有更新，再次查看时会直接显示缓存的总结
   - 如果记录有更新，会重新生成总结

#### 月度总结生成说明

- **生成时间**：根据记录数量，可能需要几秒到几十秒
- **生成内容**：基于该月所有记录的内容（不是摘要）进行分析
- **生成频率**：可以多次生成，每次都会重新分析
- **缓存更新**：只有当记录有更新时，才会重新生成

### 常见问题

#### 1. 为什么点击"记录"或"回顾"会跳转到登录页？

这是正常的安全机制。未登录用户无法访问记录和回顾页面，系统会自动跳转到登录页面。登录成功后会自动返回到原本想访问的页面。

#### 2. AI 摘要生成失败怎么办？

如果 AI 摘要生成失败，你的记录仍然会保存。可能的原因：
- API 密钥配置错误
- API 额度不足
- 网络问题

可以检查：
- 环境变量中的 `ZHIPU_API_KEY` 是否正确配置
- 智谱 AI 账户是否有足够额度
- 网络连接是否正常

#### 3. 如何删除某天的记录？

在记录页面选择该日期，清空编辑器中的所有内容，然后点击"保存"按钮。保存空内容会自动删除该日期的记录。

#### 4. 月度总结可以重新生成吗？

可以。点击"生成月度总结"按钮，选择相同的月份，可以重新生成。如果该月的记录有更新，系统会自动重新生成。

#### 5. 数据存储在哪里？

所有数据存储在 Supabase 云端数据库中，包括：
- 每日记录的内容和摘要
- 月度总结（带缓存）
- 用户账户信息

数据会自动同步，可以在任何设备上访问。

#### 6. 支持哪些浏览器？

推荐使用现代浏览器：
- Chrome（推荐）
- Firefox
- Safari
- Edge


#### 7. 可以导出数据吗？

目前不支持导出功能。数据存储在 Supabase 数据库中，可以通过 Supabase 控制台查看和导出。

#### 8. Markdown 预览在哪里？

在记录页面的编辑器中，输入 Markdown 格式的内容后，保存时会自动渲染。目前编辑器不支持实时预览，但保存后的内容会正确显示。

#### 9. 如何切换月份查看记录？

在记录页面：
- 使用左侧日历上方的 `←` 和 `→` 按钮切换月份
- 点击"今天"按钮快速跳转到当前月份和今天

在回顾页面：
- 使用月份选择器左侧的 `←` 和 `→` 按钮切换月份

#### 10. 摘要显示在哪里？

- **记录页面**：摘要显示在日历对应日期的格子里
- **回顾页面**：摘要显示在页面底部的每日摘要列表中

### 使用技巧

1. **定期记录**：建议每天记录，形成习惯，这样月度总结会更完整
2. **使用 Markdown**：合理使用 Markdown 格式可以让内容更清晰
3. **分段记录**：将不同的学习内容用空行分隔，AI 会更好地提取要点
4. **定期回顾**：每月生成一次月度总结，了解自己的学习情况
5. **关键词提取**：AI 会自动提取关键词，帮助你了解学习重点
6. **缓存利用**：月度总结有缓存机制，不需要每次都重新生成

### 安全说明

- **账户安全**：使用强密码，不要与他人分享账户
- **数据隐私**：所有数据存储在云端，只有你自己可以访问
- **API 密钥**：API 密钥存储在环境变量中，不会泄露
- **HTTPS**：生产环境使用 HTTPS 加密传输

### 功能限制

- **记录长度**：建议单条记录不超过 10000 字
- **AI 生成**：依赖智谱 AI API，需要有效 API 密钥和足够额度
- **网络要求**：需要稳定的网络连接才能正常使用
- **浏览器兼容**：不支持 IE 浏览器

## 开发

```bash
# 开发模式
npm run dev

# 构建
npm run build

# 生产模式
npm start

# 类型检查
npm run type-check

# 代码检查
npm run lint
```

## 注意事项

1. **认证**：当前版本使用 Supabase Auth，需要先配置用户认证
2. **AI 调用**：确保 ZHIPU API Key 有效且有足够额度
3. **数据库**：确保 Supabase 项目已正确配置 RLS 策略

## 许可证

MIT

